<!DOCTYPE html>
<html>
	<head>
		<title>Phomemo D30 Web Bluetooth</title>

		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css"
			integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		/>
		<link rel="stylesheet" href="index.css" />

		<!-- QR Code and Barcode libraries are imported as ES modules in index.js -->
	</head>
	<body>
		<div class="container-fluid my-4">
			<h2><b>Phomemo D30 Web Bluetooth</b></h2>
			<div style="height: 10px"></div>
			<div class="row">
				<!-- Main content: Form controls and Preview -->
				<div class="col-md-12">
					<form id="mainForm">
						<div class="tab-content mb-3" id="nav-tabContent">
							<div
								class="tab-pane show active"
								id="nav-text"
								role="tabpanel"
								aria-labelledby="nav-text-tab"
								tabindex="0"
							>
								<!-- Text Settings -->
								<div class="row mb-3">
									<div class="col-md-3">
										<h4>Text Settings</h4>
										<div class="mb-3">
											<label for="inputText" class="form-label">Text to print</label>
											<textarea class="form-control" id="inputText" rows="3">Hello world</textarea>
										</div>
										<div class="mb-3">
											<label for="fontFamily" class="form-label">Font family</label>
											<select class="form-select" id="fontFamily">
												<option value="Arial, sans-serif">Arial</option>
												<option value="Helvetica, sans-serif">Helvetica</option>
												<option value="'Times New Roman', serif">Times New Roman</option>
												<option value="'Courier New', monospace">Courier New</option>
												<option value="Georgia, serif">Georgia</option>
												<option value="Verdana, sans-serif">Verdana</option>
												<option value="'Comic Sans MS', cursive">Comic Sans MS</option>
												<option value="Impact, sans-serif">Impact</option>
											</select>
										</div>
										<div class="mb-3">
											<label for="inputFontSize" class="form-label">Font size</label>
											<div class="input-group">
												<input
													type="number"
													step="1"
													min="8"
													max="200"
													value="36"
													class="form-control"
													id="inputFontSize"
												/>
												<span class="input-group-text">px</span>
											</div>
										</div>
										<div class="mb-3">
											<label for="fontWeight" class="form-label">Font weight</label>
											<select class="form-select" id="fontWeight">
												<option value="normal">Normal</option>
												<option value="bold">Bold</option>
												<option value="lighter">Light</option>
											</select>
										</div>
										<div class="mb-3">
											<label for="textAlign" class="form-label">Text alignment</label>
											<select class="form-select" id="textAlign">
												<option value="center">Center</option>
												<option value="left">Left</option>
												<option value="right">Right</option>
											</select>
										</div>
										<div class="mb-3">
											<div class="form-check">
												<input class="form-check-input" type="checkbox" id="verticalText" />
												<label class="form-check-label" for="verticalText">
													Vertical text (stack letters)
												</label>
											</div>
										</div>
									</div>

									<!-- Image Settings -->
									<div class="col-md-3">
										<h4>Image Settings</h4>
										<div class="mb-3" id="imagePreviewGroup" style="display: none">
											<label class="form-label">Image preview</label>
											<div class="d-flex gap-2">
												<div class="flex-fill text-center">
													<small>Original</small>
													<canvas
														id="imagePreviewOriginal"
														class="img-preview border rounded"
													></canvas>
												</div>
												<div class="flex-fill text-center">
													<small>Processed</small>
													<canvas
														id="imagePreviewProcessed"
														class="img-preview border rounded"
													></canvas>
												</div>
											</div>
										</div>
										<div class="mb-3">
											<label for="inputImage" class="form-label">Upload image</label>
											<input class="form-control" type="file" id="inputImage" accept="image/*" />
										</div>
										<div class="mb-3">
											<label for="imagePosition" class="form-label">Image position</label>
											<select class="form-select" id="imagePosition">
												<option value="above">Above text</option>
												<option value="below">Below text</option>
												<option value="left">Left of text</option>
												<option value="right">Right of text</option>
												<option value="background">Behind text</option>
												<option value="none">None (text only)</option>
											</select>
										</div>
										<div class="mb-3">
											<label for="imageSize" class="form-label">Image size (%)</label>
											<input
												type="range"
												class="form-range"
												min="10"
												max="100"
												step="5"
												value="50"
												id="imageSize"
											/>
											<div class="form-text">
												<span id="imageSizeValue">50</span>% of available space
											</div>
										</div>
										<div class="mb-3">
											<label for="ditherAlgorithm" class="form-label">Dithering algorithm</label>
											<select class="form-select" id="ditherAlgorithm">
												<option value="floyd">Floyd–Steinberg</option>
												<option value="atkinson">Atkinson</option>
												<option value="stucki">Stucki</option>
												<option value="jarvis">Jarvis-Judice-Ninke</option>
												<option value="sierra">Sierra</option>
												<option value="burkes">Burkes</option>
												<option value="threshold">Threshold</option>
												<option value="ordered2">Ordered Bayer 2x2</option>
												<option value="ordered4">Ordered Bayer 4x4</option>
												<option value="ordered8">Ordered Bayer 8x8</option>
												<option value="blue_noise">Blue Noise</option>
												<option value="two_phase">Two-Phase Diffusion</option>
											</select>
										</div>
										<div class="mb-3">
											<label for="threshold" class="form-label">Threshold</label>
											<input
												type="range"
												class="form-range"
												min="0"
												max="255"
												step="1"
												value="128"
												id="threshold"
											/>
											<div class="form-text">
												<span id="thresholdValue">128</span>
											</div>
										</div>
										<div class="mb-3">
											<label for="brightness" class="form-label">Brightness</label>
											<input
												type="range"
												class="form-range"
												min="-100"
												max="100"
												step="1"
												value="0"
												id="brightness"
											/>
											<div class="form-text">
												<span id="brightnessValue">0</span>
											</div>
										</div>
										<div class="mb-3">
											<label for="contrast" class="form-label">Contrast</label>
											<input
												type="range"
												class="form-range"
												min="-100"
												max="100"
												step="1"
												value="0"
												id="contrast"
											/>
											<div class="form-text">
												<span id="contrastValue">0</span>
											</div>
										</div>
										<div class="mb-3">
											<label for="noise" class="form-label">Dither noise</label>
											<input
												type="range"
												class="form-range"
												min="0"
												max="50"
												step="1"
												value="0"
												id="noise"
											/>
											<div class="form-text">
												<span id="noiseValue">0</span> (adds randomness to dithering)
											</div>
										</div>
										<div class="mb-3">
											<label for="imageRotation" class="form-label">Image rotation</label>
											<select class="form-select" id="imageRotation">
												<option value="0">0°</option>
												<option value="90">90°</option>
												<option value="180">180°</option>
												<option value="270">270°</option>
											</select>
										</div>

										<!-- Advanced Processing Options -->
										<div class="accordion mt-4" id="advancedAccordion">
											<div class="accordion-item">
												<h2 class="accordion-header">
													<button
														class="accordion-button collapsed"
														type="button"
														data-bs-toggle="collapse"
														data-bs-target="#advancedCollapse"
														aria-expanded="false"
														aria-controls="advancedCollapse"
													>
														Advanced Processing
													</button>
												</h2>
												<div
													id="advancedCollapse"
													class="accordion-collapse collapse"
													data-bs-parent="#advancedAccordion"
												>
													<div class="accordion-body">
														<div class="mb-3">
															<div class="form-check">
																<input
																	class="form-check-input"
																	type="checkbox"
																	id="usePrinterResolution"
																/>
																<label class="form-check-label" for="usePrinterResolution">
																	Scale to printer resolution
																</label>
																<div class="form-text">
																	Scales image to exact printer DPI for optimal quality
																</div>
															</div>
														</div>

														<div class="mb-3">
															<div class="form-check">
																<input
																	class="form-check-input"
																	type="checkbox"
																	id="useGammaCorrection"
																/>
																<label class="form-check-label" for="useGammaCorrection">
																	Gamma correction
																</label>
																<div class="form-text">
																	Converts screen gamma to printer linear response
																</div>
															</div>
														</div>

														<div class="mb-3">
															<div class="form-check">
																<input
																	class="form-check-input"
																	type="checkbox"
																	id="usePreFiltering"
																/>
																<label class="form-check-label" for="usePreFiltering">
																	Pre-filtering (blur + sharpen)
																</label>
																<div class="form-text">
																	Reduces noise and enhances edges before dithering
																</div>
															</div>
														</div>

														<div class="mb-3">
															<div class="form-check">
																<input class="form-check-input" type="checkbox" id="useCLAHE" />
																<label class="form-check-label" for="useCLAHE">
																	CLAHE contrast enhancement
																</label>
																<div class="form-text">
																	Adaptive histogram equalization for better details
																</div>
															</div>
														</div>

														<div class="mb-3">
															<div class="form-check">
																<input class="form-check-input" type="checkbox" id="useEdgeAware" />
																<label class="form-check-label" for="useEdgeAware">
																	Edge-aware dithering
																</label>
																<div class="form-text">
																	Preserves thin lines and important edges
																</div>
															</div>
														</div>

														<div class="mb-3">
															<div class="form-check">
																<input
																	class="form-check-input"
																	type="checkbox"
																	id="useHardwareCleanup"
																/>
																<label class="form-check-label" for="useHardwareCleanup">
																	Hardware-safe cleanup
																</label>
																<div class="form-text">
																	Removes isolated pixels and thickens thin lines
																</div>
															</div>
														</div>

														<div class="mb-3">
															<div class="form-check">
																<input
																	class="form-check-input"
																	type="checkbox"
																	id="serpentine"
																	checked
																/>
																<label class="form-check-label" for="serpentine">
																	Serpentine scanning
																</label>
																<div class="form-text">
																	Alternates scan direction to reduce banding
																</div>
															</div>
														</div>

														<div class="mb-3">
															<label for="gamma" class="form-label">Gamma value</label>
															<input
																type="range"
																class="form-range"
																min="1.0"
																max="3.0"
																step="0.1"
																value="2.2"
																id="gamma"
															/>
															<div class="form-text">
																<span id="gammaValue">2.2</span> (2.2 = standard screen gamma)
															</div>
														</div>

														<div class="mb-3">
															<label for="blurSigma" class="form-label">Pre-blur strength</label>
															<input
																type="range"
																class="form-range"
																min="0.1"
																max="2.0"
																step="0.1"
																value="0.5"
																id="blurSigma"
															/>
															<div class="form-text">
																<span id="blurSigmaValue">0.5</span> (reduces noise before
																dithering)
															</div>
														</div>

														<div class="mb-3">
															<label for="unsharpAmount" class="form-label">Edge enhancement</label>
															<input
																type="range"
																class="form-range"
																min="0.0"
																max="2.0"
																step="0.1"
																value="0.8"
																id="unsharpAmount"
															/>
															<div class="form-text">
																<span id="unsharpAmountValue">0.8</span> (restores edge sharpness)
															</div>
														</div>

														<div class="mb-3">
															<label for="claheClipLimit" class="form-label"
																>CLAHE clip limit</label
															>
															<input
																type="range"
																class="form-range"
																min="1.0"
																max="4.0"
																step="0.1"
																value="2.0"
																id="claheClipLimit"
															/>
															<div class="form-text">
																<span id="claheClipLimitValue">2.0</span> (prevents
																over-enhancement)
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>

									<!-- QR Code & Barcode Settings -->
									<div class="col-md-3">
										<h4>QR Code & Barcode</h4>
										<div class="mb-3">
											<label for="codeType" class="form-label">Code type</label>
											<select class="form-select" id="codeType">
												<option value="none">None</option>
												<option value="qr">QR Code</option>
												<option value="barcode">Barcode (CODE128)</option>
											</select>
										</div>
										<div class="mb-3" id="codeDataGroup">
											<label for="codeData" class="form-label">Code data</label>
											<textarea
												class="form-control"
												id="codeData"
												rows="2"
												placeholder="Enter text or data to encode"
											></textarea>
										</div>
										<div class="mb-3" id="codePositionGroup">
											<label for="codePosition" class="form-label">Code position</label>
											<select class="form-select" id="codePosition">
												<option value="above">Above text</option>
												<option value="below">Below text</option>
												<option value="left">Left of text</option>
												<option value="right">Right of text</option>
												<option value="background">Behind text</option>
											</select>
										</div>
										<div class="mb-3" id="codeSizeGroup">
											<label for="codeSize" class="form-label">Code size (%)</label>
											<input
												type="range"
												class="form-range"
												min="10"
												max="100"
												step="5"
												value="30"
												id="codeSize"
											/>
											<div class="form-text">
												<span id="codeSizeValue">30</span>% of available space
											</div>
										</div>
										<div class="mb-3" id="qrErrorCorrectionGroup" style="display: none">
											<label for="qrErrorCorrection" class="form-label">QR Error correction</label>
											<select class="form-select" id="qrErrorCorrection">
												<option value="L">Low (7%)</option>
												<option value="M" selected>Medium (15%)</option>
												<option value="Q">Quartile (25%)</option>
												<option value="H">High (30%)</option>
											</select>
										</div>
										<div class="mb-3" id="barcodeFormatGroup" style="display: none">
											<label for="barcodeFormat" class="form-label">Barcode format</label>
											<select class="form-select" id="barcodeFormat">
												<option value="CODE128">CODE128</option>
												<option value="CODE39">CODE39</option>
												<option value="EAN13">EAN13</option>
												<option value="EAN8">EAN8</option>
												<option value="UPC">UPC</option>
											</select>
										</div>
									</div>

									<!-- Preview -->
									<div class="col-md-3">
										<h4>Preview</h4>
										<p class="text-left">Images are sent to printer vertically.</p>

										<div class="d-flex flex-column align-items-center mb-4">
											<div class="mb-3 align-center-start">
												<h5 class="text-center">Preview rotation</h5>
												<div class="btn-group" role="group" aria-label="Preview rotation">
													<button
														type="button"
														class="btn btn-outline-secondary"
														id="rotateCounterClockwise"
													>
														↺ 90° CCW
													</button>
													<button
														type="button"
														class="btn btn-outline-secondary"
														id="rotateClockwise"
													>
														↻ 90° CW
													</button>
												</div>
											</div>

											<div class="card shadow-sm">
												<div class="card-body p-1">
													<div class="preview-container">
														<canvas id="canvas"></canvas>
													</div>
												</div>
											</div>

											<button type="submit" class="btn btn-primary mt-3" form="mainForm">
												Connect &amp; print
											</button>
										</div>

										<div class="mt-4">
											<h4>Print offset</h4>
											<p class="text-muted small">
												Adjust position to compensate for printer alignment
											</p>

											<div class="d-flex justify-content-center mb-3">
												<div class="btn-group-vertical me-3">
													<button
														type="button"
														class="btn btn-outline-secondary btn-sm"
														id="offsetUp"
													>
														↑
													</button>
													<div class="btn-group">
														<button
															type="button"
															class="btn btn-outline-secondary btn-sm"
															id="offsetLeft"
														>
															←
														</button>
														<button
															type="button"
															class="btn btn-outline-secondary btn-sm"
															id="offsetReset"
														>
															⌂
														</button>
														<button
															type="button"
															class="btn btn-outline-secondary btn-sm"
															id="offsetRight"
														>
															→
														</button>
													</div>
													<button
														type="button"
														class="btn btn-outline-secondary btn-sm"
														id="offsetDown"
													>
														↓
													</button>
												</div>
												<div class="align-self-center">
													<div class="text-center small">
														<div>X: <span id="offsetXValue">0</span>px</div>
														<div>Y: <span id="offsetYValue">0</span>px</div>
													</div>
												</div>
											</div>

											<div class="row mb-3">
												<div class="col-6">
													<label for="offsetStep" class="form-label">Step size</label>
													<select class="form-select form-select-sm" id="offsetStep">
														<option value="1">1px</option>
														<option value="2">2px</option>
														<option value="5" selected>5px</option>
														<option value="10">10px</option>
														<option value="20">20px</option>
													</select>
												</div>
											</div>
										</div>

										<div class="mt-4">
											<h4>Label size</h4>
											<div class="input-group mb-3">
												<span class="input-group-text">Width (mm)</span>
												<input
													type="number"
													step="1"
													class="form-control"
													value="40"
													aria-label="Width"
													id="inputWidth"
												/>
												<span class="input-group-text">Height (mm)</span>
												<input
													type="number"
													step="1"
													class="form-control"
													value="12"
													aria-label="Height"
													id="inputHeight"
												/>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div
								class="tab-pane"
								id="nav-barcode"
								role="tabpanel"
								aria-labelledby="nav-barcode-tab"
								tabindex="0"
							>
								<h2>Barcode</h2>
								<label for="inputBarcode" class="form-label">Barcode data (CODE128)</label>
								<input type="text" class="form-control" value="123456" id="inputBarcode" />
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>

		<div class="toast-container position-fixed bottom-0 start-0 p-3">
			<div
				id="errorToast"
				class="toast align-items-center text-bg-danger border-0"
				role="alert"
				aria-live="assertive"
				aria-atomic="true"
			>
				<div class="d-flex">
					<div class="toast-body">
						<span id="errorText"></span>
					</div>
					<button
						type="button"
						class="btn-close btn-close-white me-2 m-auto"
						data-bs-dismiss="toast"
						aria-label="Close"
					></button>
				</div>
			</div>
		</div>

		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"
			integrity="sha512-7Pi/otdlbbCR+LnW+F7PwFcSDJOuUJB3OxtEHbg4vSMvzvJjde4Po1v4BR9Gdc9aXNUNFVUY+SK51wWT8WF0Gg=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		></script>
		<script type="module" src="index.js" defer></script>
	</body>
</html>
